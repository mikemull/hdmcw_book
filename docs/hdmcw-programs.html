<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Episode 3: Programs ‚Äì How Does My ü§¨ Computer Work</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./hdmcw-virtual.html" rel="next">
<link href="./hdmcw-memory.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./hdmcw-programs.html">Episode 3: Programs</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">How Does My ü§¨ Computer Work</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hdmcw-prank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Episode 1: Prank</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hdmcw-memory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Episode 2: Memory</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hdmcw-programs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Episode 3: Programs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hdmcw-virtual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Episode 4: Virtual Memory</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hdmcw-processes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Episode 5: Processes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hdmcw-threads.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Episode 7: Threads</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hdmcw-scheduler.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Episode 8: Schedulers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Episode 3: Programs</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Before getting into the technical details of how the computer loads and executes program, I want to talk about programs more generally. It‚Äôs surprisingly hard to define what a computer <em>program</em> really is. Usually you‚Äôll see something about ‚Äúa set of instructions performed by a computer to perform a task‚Äù, but that leaves a lot of room for interpretation<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. If you try to get more precise, you‚Äôll end up talking about Turing machines or (God forbid) lambda calculus. The only constraint I‚Äôm going to put on programs for now is that i‚Äôll usually be talking about programs where the source code is translated directly into machine instructions that the CPU can execute. This is in contrast to programming languages that use another program to interpret instructions at runtime or that use a <em>virtual machine</em> to translate a machine-agnostic code into machine-specific instructions. That‚Äôs not because one type of program is necessarily better than another, but my focus is on what the computer is doing.</p>
<p>There‚Äôs sort of a meta-question here though: is the <em>program</em> the stuff that we write into a file, or is it the stuff that the computer executes? I‚Äôm going to meta-answer with the meta-response ‚ÄúYes‚Äù. For now, i‚Äôm going to focus more on how we make the thing that the computer executes, and save the part about how the computer executes the thing for later.</p>
<p>In the first two episodes we wrote two assembly language programs, and I skirted around a bunch of details including things like ‚Äúwhat is assembly language‚Äù? If your nerd energy is strong enough to have made it this far, you probably don‚Äôt need an answer to that, but I‚Äôll just say that it‚Äôs the lowest level at which you can program except for entering numbers directly into the computer‚Äôs memory. Each assembly language instruction maps to a machine-level <em>operation code</em> or <em>opcode</em><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> and usually some operands that tell the <em>opcode</em> what to operate on. As we saw in the last episode, each line of assembly maps to numbers that instruct the CPU what to do. Assembly language also has <em>labels</em> that designate specific places in the program, and various other directives that we‚Äôll discuss in a while.</p>
<p>What I‚Äôll start to answer now is: How does the assembly language get turned into numbers like what we saw in the computer‚Äôs memory in Episode 2? The simple answer is ‚Äúthe assembler‚Äù. An assembler is yet another program that takes the assembly language source code and turns it into machine code. Let‚Äôs imagine that the program in the last episode is written in a file called <strong>adder.s</strong> (I don‚Äôt have to imagine it because it is). The assembler program on my Mac is called <strong>as</strong> <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>, so i can assemble the source program with the command:</p>
<pre><code>as -o adder.o adder.s</code></pre>
<p>This produces the file <strong>adder.o</strong> , which is called an <em>object file</em>, and on the Mac it‚Äôs in a format called Mach-O, which i <em>think</em> is pronounced ‚Äúmock oh‚Äù and not ‚Äúmacho‚Äù. The equivalent on Unix systems is <em>Executable and Linkable Format</em> (ELF). Let‚Äôs look at the contents of this file. We‚Äôll use <strong>xxd</strong> since it‚Äôs a binary file.</p>
<pre class="console"><code>foo@bar:~$ file adder.o
adder.o: Mach-O 64-bit object arm64</code></pre>
<pre class="console"><code>foo@bar:~$ xxd adder.o

00000000: cffa edfe 0c00 0001 0000 0000 0100 0000  ................
00000010: 0400 0000 6801 0000 0000 0000 0000 0000  ....h...........
00000020: 1900 0000 e800 0000 0000 0000 0000 0000  ................
00000030: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000040: 3800 0000 0000 0000 8801 0000 0000 0000  8...............
00000050: 3800 0000 0000 0000 0700 0000 0700 0000  8...............
00000060: 0200 0000 0000 0000 5f5f 7465 7874 0000  ........__text..
00000070: 0000 0000 0000 0000 5f5f 5445 5854 0000  ........__TEXT..
00000080: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000090: 2c00 0000 0000 0000 8801 0000 0400 0000  ,...............
000000a0: c001 0000 0600 0000 0004 0080 0000 0000  ................
000000b0: 0000 0000 0000 0000 5f5f 6461 7461 0000  ........__data..
000000c0: 0000 0000 0000 0000 5f5f 4441 5441 0000  ........__DATA..
000000d0: 0000 0000 0000 0000 2c00 0000 0000 0000  ........,.......
000000e0: 0c00 0000 0000 0000 b401 0000 0000 0000  ................
000000f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000100: 0000 0000 0000 0000 3200 0000 1800 0000  ........2.......
00000110: 0100 0000 0000 0e00 0000 0000 0000 0000  ................
00000120: 0200 0000 1800 0000 f001 0000 0600 0000  ................
00000130: 5002 0000 2800 0000 0b00 0000 5000 0000  P...(.......P...
00000140: 0000 0000 0500 0000 0500 0000 0100 0000  ................
00000150: 0600 0000 0000 0000 0000 0000 0000 0000  ................
00000160: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000170: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000180: 0000 0000 0000 0000 0100 0090 2100 0091  ............!...
00000190: 2200 40b9 0300 0090 6300 0091 6400 40b9  ".@.....c...d.@.
000001a0: 8200 028b 0500 0090 a500 0091 a200 00f9  ................
000001b0: 4000 20d4 1100 0000 1900 0000 0000 0000  @. .............
000001c0: 2000 0000 0300 004c 1c00 0000 0300 003d   ......L.......=
000001d0: 1000 0000 0200 004c 0c00 0000 0200 003d  .......L.......=
000001e0: 0400 0000 0100 004c 0000 0000 0100 003d  .......L.......=
000001f0: 1d00 0000 0e01 0000 0000 0000 0000 0000  ................
00000200: 1800 0000 0e02 0000 2c00 0000 0000 0000  ........,.......
00000210: 0800 0000 0e02 0000 3000 0000 0000 0000  ........0.......
00000220: 0d00 0000 0e02 0000 3400 0000 0000 0000  ........4.......
00000230: 1200 0000 0e02 0000 2c00 0000 0000 0000  ........,.......
00000240: 0100 0000 0f01 0000 0000 0000 0000 0000  ................
00000250: 005f 7374 6172 7400 6d79 6132 006d 7973  ._start.mya2.mys
00000260: 3100 6c74 6d70 3100 6d79 6131 006c 746d  1.ltmp1.mya1.ltm
00000270: 7030 0000 0000 0000                      p0......</code></pre>
<p>Alrighty then. So if you squint you will see in there the hex values for our opcodes and data, plus some extra goodies like <strong>__text</strong> and <strong>__data</strong>, and also some text that matches our variable names (and, importantly, our <strong>_start</strong> label). For the most part this doesn‚Äôt tell us much, except that our assembler has produced a binary file that represents the code we wrote.</p>
<p>Fortunately, there‚Äôs a utility on OSX that lets you examine Mach-O files in various ways. For one, we can disassemble it:</p>
<pre class="console"><code>foo@bar:~$ objdump -d adder.o

adder.o:    file format mach-o arm64

Disassembly of section __TEXT,__text:

0000000000000000 &lt;ltmp0&gt;:
       0: 90000001      adrp    x1, 0x0 &lt;ltmp0&gt;
       4: 91000021      add x1, x1, #0
       8: b9400022      ldr w2, [x1]
       c: 90000003      adrp    x3, 0x0 &lt;ltmp0+0xc&gt;
      10: 91000063      add x3, x3, #0
      14: b9400064      ldr w4, [x3]
      18: 8b020082      add x2, x4, x2
      1c: 90000005      adrp    x5, 0x0 &lt;ltmp0+0x1c&gt;
      20: 910000a5      add x5, x5, #0
      24: f90000a2      str x2, [x5]
      28: d4200040      brk #0x2
</code></pre>
<p>Nice. That‚Äôs our program, and it even has hex for the instructions! (Note: the part of the object file with the program code is referred to as the ‚Äútext section‚Äù) So, were done, right! We can just run this and‚Ä¶ wait no, sorry, this is not an <em>executable</em> file. To make an actual runnable program we have to use a second program, the <em>linker</em>, which naturally is called <strong>ld</strong>.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> The command for the linker is also fairly short in this case:</p>
<pre class="console"><code>foo@bar:~$ ld -o adder adder.o -e _start -arch arm64 </code></pre>
<p>First, it‚Äôs using <strong>-o adder</strong> to say that we want the executable program to be called <strong>adder</strong>. Then it takes the name of our object file as input. Now, normally the <strong>ld</strong> command sort of gets mental. It often takes numerous arguments for libraries, directories to look in, optimization levels, etc.</p>
<p>The option <strong>-e _start</strong> tells the linker where the executable starts, and here we need to go back to the source code. Recall that in both of our programs so far we‚Äôve had this bit at the beginning:</p>
<pre><code>.global _start             // Provide program starting address to linker
.align 4

_start: 
</code></pre>
<p>Using <strong>objdump</strong> we can look at the <em>symbol table</em> in our binary program file, and we see:</p>
<pre class="console"><code>foo@bar:~$ objdump --syms adder

adder:  file format mach-o arm64

SYMBOL TABLE:
0000000100004000 l     O __DATA,__data mya1
0000000100004004 l     O __DATA,__data mya2
0000000100004008 l     O __DATA,__data mys1
0000000100000000 g     F __TEXT,__text __mh_execute_header
0000000100003f70 g     F __TEXT,__text _start
</code></pre>
<p>Right there is the ‚Äú_start‚Äù symbol, and hey, it has the address that we saw in the last episode corresponding to the first instruction. That‚Äôs an amazing coincidence.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. Why does the linker need to know where the start of our program is? Doesn‚Äôt it just start at, like, 0? The linker‚Äôs job is to combine various files into an executable program. In this case, we‚Äôve only got one object file, so the other files that are getting linked are system-level libraries. However, in most complex programs there will be many object files and so the linker needs to know the entry point for the combined files. That‚Äôs why the ‚Äú_start‚Äù symbol is a <em>global</em> symbol. If you were writing, say, C code the global start symbol would be in the runtime library.</p>
<p>If we look at the final runnable program (<strong>adder</strong>), we‚Äôll see that it‚Äôs way larger than the object file (<strong>adder.o</strong>) even though the latter holds all of the code we wrote.</p>
<pre class="console"><code>foo@bar:~$ ls -l
total 96
-rw-r--r--  1 mikemull  staff    184 Jul 19 16:05 Makefile
-rwxr-xr-x  1 mikemull  staff  33432 Aug  5 10:30 adder
-rw-r--r--  1 mikemull  staff    632 Aug  5 10:30 adder.o
-rw-r--r--  1 mikemull  staff    553 Aug  5 10:30 adder.s</code></pre>
<p>Most of that is because the linker adds more of what are called ‚Äúload commands‚Äù to the resulting binary, which are essentially instructions that tell the operating system how to load the program.</p>
<p>So, we‚Äôve more or less covered the ‚ÄúHow does assembly get turned into numbers‚Äù part, skipping over (for now) details about how the actual files are created and read/written. Next we need to start thinking about how the stuff in that file gets executed by the computer. This is where the operating system gets really hard to separate from the hardware. The OS has the responsibility for loading the numbers that comprise our program, but it‚Äôs not a simple matter of taking the bits from a disk or SSD and putting them into physical memory. Before we talk about how the instructions are executed, we‚Äôre going to have to return to our discussion of memory and finally talk about <em>virtual memory</em>. That will be the subject of the <a href="hdmcw-virtual.html">next episode</a>.</p>


<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Pun intended.<a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn2"><p>Everyone says <em>opcode</em>. It just sounds cooler.<a href="#fnref2" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn3"><p>I think <strong>as</strong> just calls <strong>clang</strong>, which is part of the <a href="https://llvm.org/">LLVM</a> toolset (as is <strong>objdump</strong>).<a href="#fnref3" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn4"><p>I assume it‚Äôs not called <strong>ln</strong> because that was already taken. It‚Äôs kind of like that <a href="https://www.youtube.com/watch?v=NA6CaeSY8fs">Demetri Martin joke about oranges and carrots</a>.<a href="#fnref4" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn5"><p>No, it‚Äôs not.<a href="#fnref5" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./hdmcw-memory.html" class="pagination-link" aria-label="Episode 2: Memory">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Episode 2: Memory</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./hdmcw-virtual.html" class="pagination-link" aria-label="Episode 4: Virtual Memory">
        <span class="nav-page-text">Episode 4: Virtual Memory</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>